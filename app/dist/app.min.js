angular.module("AhsOnfline",[]).service("Onfline",["$window",function(n){this.isOnline=function(){return!!n.navigator.onLine},this.isOffline=function(){return!n.navigator.onLine},this.whenOnline=function(e){n.addEventListener("online",e)},this.whenOffline=function(e){n.addEventListener("offline",e)}}]),angular.module("AhsSyncForage",["AhsOnfline"]).provider("SyncForage",function(){function n(n){angular.extend(e,n)}var e={name:"AhsSyncForage_DB",storeName:"keyvaluepairs",syncURL:"/syncforage",autoSync:!0,autoSyncPeriod:60,versionFieldName:"AhsSyncForage_Version"},t=null;return{config:n,$get:["$http","$q","Onfline",function(r,o,i){function a(){n({autoSync:!1})}function u(){e.autoSync?i.whenOnline(function(){s()}):(t=localforage.createInstance(e),F=null)}function c(n,r,i){p();var a;return n==e.versionFieldName?a=o.when():(a=t.setItem(n,r).then(function(){m(I,n),y(O,n),S[n]=r}),e.autoSync&&(a=a.then(s()))),g(i,a)}function l(n,e){p();var r;return r=Object.keys(S).indexOf(n)>=0?o.when(S[n]):I.indexOf(n)>=0?o.when(void 0):t.getItem(n).then(function(e){return S[n]=e,e}),g(e,r,!0)}function f(n,r){p();var i;return n==e.versionFieldName?i=o.when():(y(I,n)?(m(O,n),i=t.removeItem(n)):i=o.when(),e.autoSync&&(i=i.then(s()))),i=i.then(function(){delete S[n]}),g(r,i)}function s(n){p();var i={},a=[];O.forEach(function(n){void 0!==S[n]?i[n]=S[n]:a.push(t.getItem(n).then(function(t){i[n]=n!=e.versionFieldName?t||null:t||0}))});var u=o.all(a).then(function(){var n={};return r.post(e.syncURL,{items:i,changed:O,removed:I},n).then(function(n){O=[e.versionFieldName],I=[];var r=n.data.items||{},i=n.data.changed||[],u=n.data.removed||[];return a=[],i.forEach(function(n){a.push(t.setItem(n,r[n]).then(function(){S[n]=r[n]}))}),u.forEach(function(n){a.push(t.removeItem(n).then(function(){delete S[n]}))}),o.all(a)})});return g(n,u)}function d(n){return n?e.syncURL=n:e.syncURL}function h(n){return void 0===n?e.autoSync:e.autoSync=n}function v(){return t}function g(n,e,t){return"function"==typeof n?e.then(function(e){n(e)},function(e){t?n(void 0,e):n(e)}):e}function y(n,e){var t=n.indexOf(e);return t<0&&n.push(e),t<0}function m(n,e){var t=n.indexOf(e);return t>=0&&n.splice(t,1),t>=0}function p(){if(!t)throw new Error("AhsSyncForage is not initialized yet. Please configure SyncForageProvider.config([options]) first.")}var S={},O=[],I=[],F=null;return O.push(e.versionFieldName),u(),{config:function(e){n(e),u()},setItem:c,getItem:l,removeItem:f,sync:s,syncURL:d,autoSync:h,getLocalForageInstance:v,test:a}}]}}),angular.module("Everseen",["ui.router","AhsSyncForage"]).run(function(){}).config(["$stateProvider","$urlRouterProvider","SyncForageProvider",function(n,e,t){e.otherwise("/"),n.state("home",{url:"/",templateUrl:"/home_template",data:{},controller:"MasterController"}).state("about",{url:"/about",template:"<div><h2>My timer application</h2><h3>A survey on AngularJS applications !</h3></div>"}),t.config({syncURL:"/everseen/syncforage"})}]).controller("MasterController",["$scope","$http","SyncForage",function(n,e,t){n.title="Everseen!",n.dataIn="- - -",n.dataOut={},n.error=null,n.setIt=function(){e.post("/everseen/set/data",n.dataOut).then(function(e){n.error=null,n.dataIn="- - -",alert("DONE!\n"+JSON.stringify(e.data,null,4))},function(e){n.error=e})},n.getAll=function(){e.post("/everseen/get/all",{}).then(function(e){n.error=null,n.dataIn=JSON.stringify(e.data,null,4)},function(e){n.error=e})},n.delAll=function(){e.post("/everseen/delete/all").then(function(e){n.error=null,n.dataIn="- - -",alert("DONE!\n"+JSON.stringify(e.data,null,4))},function(e){n.error=e})},n.testIt=function(){t.test()}}]);