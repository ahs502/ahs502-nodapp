angular.module("AhsOnfline",[]).service("Onfline",["$window",function(n){this.isOnline=function(){return!!n.navigator.onLine},this.isOffline=function(){return!n.navigator.onLine},this.whenOnline=function(e){n.addEventListener("online",e)},this.whenOffline=function(e){n.addEventListener("offline",e)}}]),angular.module("AhsSyncForage",["AhsOnfline"]).provider("SyncForage",function(){function n(n){angular.extend(e,n),t=localforage.createInstance(e)}var e={name:"AhsSyncForage_DB",storeName:"keyvaluepairs",syncURL:"/syncforage",autoSync:!0,versionFieldName:"AhsSyncForage_Version"},t=null;return{config:n,$get:["$http","$q","Onfline",function(r,o,i){function a(){n({autoSync:!1})}function u(n,r,i){var a;return n==e.versionFieldName?a=o.when():(a=t.setItem(n,r).then(function(){m(O,n),g(p,n),y[n]=r}),e.autoSync&&(a=a.then(f()))),v(i,a)}function c(n,e){var r;return r=Object.keys(y).indexOf(n)>=0?o.when(y[n]):O.indexOf(n)>=0?o.when(void 0):t.getItem(n).then(function(e){return y[n]=e,e}),v(e,r,!0)}function l(n,r){var i;return n==e.versionFieldName?i=o.when():(g(O,n)?(m(p,n),i=t.removeItem(n)):i=o.when(),e.autoSync&&(i=i.then(f()))),i=i.then(function(){delete y[n]}),v(r,i)}function f(n){var i={},a=[];p.forEach(function(n){void 0!==y[n]?i[n]=y[n]:a.push(t.getItem(n).then(function(t){i[n]=n!=e.versionFieldName?t||null:t||0}))});var u=o.all(a).then(function(){var n={};return r.post(e.syncURL,{items:i,changed:p,removed:O},n).then(function(n){p=[e.versionFieldName],O=[];var r=n.data.items||{},i=n.data.changed||[],u=n.data.removed||[];return a=[],i.forEach(function(n){a.push(t.setItem(n,r[n]).then(function(){y[n]=r[n]}))}),u.forEach(function(n){a.push(t.removeItem(n).then(function(){delete y[n]}))}),o.all(a)})});return v(n,u)}function s(n){return n?e.syncURL=n:e.syncURL}function d(n){return void 0===n?e.autoSync:e.autoSync=n}function h(){return t}function v(n,e,t){return"function"==typeof n?e.then(function(e){n(e)},function(e){t?n(void 0,e):n(e)}):e}function g(n,e){var t=n.indexOf(e);return 0>t&&n.push(e),0>t}function m(n,e){var t=n.indexOf(e);return t>=0&&n.splice(t,1),t>=0}var y={},p=[],O=[];return p.push(e.versionFieldName),{config:n,setItem:u,getItem:c,removeItem:l,sync:f,syncURL:s,autoSync:d,getLocalForageInstance:h,test:a}}]}}),angular.module("Everseen",["ui.router","AhsSyncForage"]).run(function(){}).config(["$stateProvider","$urlRouterProvider","SyncForageProvider",function(n,e,t){e.otherwise("/"),n.state("home",{url:"/",templateUrl:"/home_template",data:{},controller:"MasterController"}).state("about",{url:"/about",template:"<div><h2>My timer application</h2><h3>A survey on AngularJS applications !</h3></div>"}),t.config({syncURL:"/everseen/syncforage"})}]).controller("MasterController",["$scope","$http","SyncForage",function(n,e,t){n.title="Everseen!",n.dataIn="- - -",n.dataOut={},n.error=null,n.setIt=function(){e.post("/everseen/set/data",n.dataOut).then(function(e){n.error=null,n.dataIn="- - -",alert("DONE!\n"+JSON.stringify(e.data,null,4))},function(e){n.error=e})},n.getAll=function(){e.post("/everseen/get/all",{}).then(function(e){n.error=null,n.dataIn=JSON.stringify(e.data,null,4)},function(e){n.error=e})},n.delAll=function(){e.post("/everseen/delete/all").then(function(e){n.error=null,n.dataIn="- - -",alert("DONE!\n"+JSON.stringify(e.data,null,4))},function(e){n.error=e})},n.testIt=function(){t.test()}}]);